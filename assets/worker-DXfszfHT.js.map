{"version":3,"file":"worker-DXfszfHT.js","sources":["../src/particles.ts","../src/worker.ts"],"sourcesContent":["import { ShapeType } from \"./types\";\n\nexport function bokeh(\n    ctx: CanvasRenderingContext2D,\n    x: number, y: number,\n    r: number, t: typeof ShapeType[keyof typeof ShapeType], s: number, rr: number, ro: number,\n    hrh: number, hh: number, hs: number, hl: number, ha: number,\n    min: number,\n    height: number,\n    enableStroke: boolean,\n    blur: number,\n    randomRange: [number, number],\n) {\n    ctx.shadowBlur = r / min * (Math.random() * 15 + 1) * blur;\n\n    ctx.strokeStyle = enableStroke ? \"rgba(0, 0, 0, 0.5)\" : \"transparent\";\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.3)\";\n    if (hrh > 0) {\n        if (hrh > 1) {\n            hh = Math.round(Math.random() * (randomRange[1] - randomRange[0]) + randomRange[0]);\n        } else {\n            hh = Math.round(Math.random() * 360);\n        }\n    }\n    ctx.shadowColor = \"hsla(\" + hh + \", \" + hs + \"%, \" + hl + \"%, \" + ha + \")\";\n\n    ctx.save();\n    ctx.translate(x, y + height);\n    ctx.beginPath();\n    // @ts-ignore\n    switch (parseInt(t)) {\n        case 1:\n            polygon(ctx, r, s, rr, ro);\n            break;\n        case 2:\n            nstar(ctx, r, s, rr, ro);\n            break;\n        case 3:\n            heart(ctx, r, rr, ro);\n            break;\n        default:\n            ctx.arc(0, 0, r, 0, 2 * Math.PI);\n            break;\n    }\n    ctx.fill();\n    ctx.stroke();\n    ctx.restore();\n}\n\nfunction polygon(\n    ctx: CanvasRenderingContext2D,\n    r: number, s: number, rr: number, ro: number\n) {\n    let a = 2 * Math.PI / s;\n\n    ctx.rotate(rr * (1 - 2 * Math.random()) * Math.PI + a / 2 + ro);\n\n    ctx.moveTo(0, r);\n    for (var i = 0; i < s; i++) {\n        ctx.rotate(a);\n        ctx.lineTo(0, r);\n    }\n}\n\nfunction nstar(\n    ctx: CanvasRenderingContext2D,\n    r: number, s: number, rr: number, ro: number\n) {\n    let a = 2 * Math.PI / s;\n\n    ctx.rotate(rr * (1 - 2 * Math.random()) * Math.PI + a / 2 + ro);\n\n    ctx.moveTo(0, r);\n    for (var i = 0; i < 2 * s; i++) {\n        ctx.rotate(a / 2);\n        ctx.lineTo(0, r - (i % 2 == 0 ? 1 : 0) * 2 * r / 3);\n    }\n}\n\nfunction heart(\n    ctx: CanvasRenderingContext2D,\n    r: number, rr: number, ro: number\n) {\n    ctx.rotate(rr * (1 - 2 * Math.random()) * Math.PI + ro);\n\n    ctx.moveTo(0, 3 * r / 2);\n    ctx.arc(-r / 2, 0, r / 2, 3 * Math.PI / 4, 0);\n    ctx.arc(r / 2, 0, r / 2, Math.PI, Math.PI / 4);\n    ctx.lineTo(0, 3 * r / 2);\n}\n","import { bokeh } from './particles';\nimport type { ShapeType } from './types';\n\ninterface WorkerSettings {\n    width: number;\n    height: number;\n    shape: number;\n    vertices: number;\n    maxradius: number;\n    randomrot: boolean;\n    blur: number;\n    enableStroke: boolean;\n    rotation: number;\n    number: number;\n    randomhue: number;\n    randomhue_range_start: number;\n    randomhue_range_end: number;\n    hue: number;\n    saturation: number;\n    lightness: number;\n    alpha: number;\n}\n\nconst bokehWithOffscreen = (\n    ctx: OffscreenCanvasRenderingContext2D | CanvasRenderingContext2D,\n    x: number, y: number,\n    r: number, t: typeof ShapeType[keyof typeof ShapeType], s: number, rr: number, ro: number,\n    hrh: number, hh: number, hs: number, hl: number, ha: number,\n    min: number,\n    height: number,\n    enableStroke: boolean,\n    blur: number,\n    randomRange: [number, number]\n) => {\n    return bokeh(ctx as CanvasRenderingContext2D, x, y, r, t, s, rr, ro, hrh, hh, hs, hl, ha, min, height, enableStroke, blur, randomRange);\n};\n\nself.onmessage = (e: MessageEvent) => {\n    const settings: WorkerSettings = e.data;\n    const canvas = new OffscreenCanvas(settings.width, settings.height);\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    ctx.globalCompositeOperation = 'lighter';\n    ctx.lineWidth = 3;\n    ctx.shadowOffsetY = -settings.height - settings.maxradius;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const max = settings.maxradius,\n        min = max / 2;\n\n    for (let i = 0; i < settings.number; i++) {\n        const x = Math.floor(settings.width * Math.random()),\n            r = max - min * Math.random(),\n            y = Math.floor(settings.height * Math.random()) + max;\n\n        bokehWithOffscreen(\n            ctx,\n            x, y, r,\n            settings.shape as typeof ShapeType[keyof typeof ShapeType],\n            settings.vertices,\n            settings.randomrot ? 1 : 0,\n            Math.PI * settings.rotation / 180,\n            settings.randomhue,\n            settings.hue,\n            settings.saturation,\n            settings.lightness,\n            settings.alpha,\n            min,\n            settings.height,\n            settings.enableStroke,\n            settings.blur,\n            [settings.randomhue_range_start, settings.randomhue_range_end]\n        );\n    }\n\n    // Transfer the image data back to the main thread\n    const imageData = ctx.getImageData(0, 0, settings.width, settings.height);\n    self.postMessage({ imageData }, { transfer: [imageData.data.buffer] });\n}; "],"names":["bokeh","ctx","x","y","r","t","s","rr","ro","hrh","hh","hs","hl","ha","min","height","enableStroke","blur","randomRange","shadowBlur","Math","random","strokeStyle","fillStyle","round","shadowColor","save","translate","beginPath","parseInt","a","PI","rotate","moveTo","i","lineTo","polygon","nstar","arc","heart","fill","stroke","restore","bokehWithOffscreen","self","onmessage","e","settings","data","canvas","OffscreenCanvas","width","getContext","globalCompositeOperation","lineWidth","shadowOffsetY","maxradius","clearRect","max","number","floor","shape","vertices","randomrot","rotation","randomhue","hue","saturation","lightness","alpha","randomhue_range_start","randomhue_range_end","imageData","getImageData","postMessage","transfer","buffer"],"mappings":"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"}